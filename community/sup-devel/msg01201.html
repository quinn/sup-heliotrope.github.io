<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;devel] [PATCHv2] idle and unidle updates -->
<!--X-From-R13: Sevp Eurezna <ulcreobyvfgNtznvy.pbz> -->
<!--X-Date: Fri, 22 Jan 2010 12:22:35 &#45;0800 (PST) -->
<!--X-Message-Id: 1264190784&#45;sup&#45;222@changeling.local -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1263483819&#45;sup&#45;9886@changeling.local -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-devel] [PATCHv2] idle and unidle updates</title>
<link rev="made" href="mailto:hyperbolist@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg01162.html">Date Prev</a>][<a href="msg01209.html">Date Next</a>][<a href="msg01312.html">Thread Prev</a>][<a href="msg01235.html">Thread Next</a>][<a href="maillist.html#01201">Date Index</a>][<a href="threads.html#01201">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-devel] [PATCHv2] idle and unidle updates</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sup-devel &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-devel] [PATCHv2] idle and unidle updates</li>
<li><em>From</em>: Eric Sherman &lt;<a href="mailto:hyperbolist%40gmail.com">hyperbolist@gmail.com</a>&gt;</li>
<li><em>Date</em>: Fri, 22 Jan 2010 15:13:01 -0500</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:received:received:content-type:subject:from:to	:in-reply-to:references:date:message-id:user-agent	:content-transfer-encoding;	bh=dREwOvPqmAFbMQZySnndcHv7oBtq9bmtPU8WUq80YLk=;	b=c86nIYwicRRR91xvXjvh/xACAcF7KpY5AAUh461IjHTiegYgKtk3W1KLOTbQ7XfGqx	cv11ucFwIxOBX6Ho5Qof8XQDCFIxGU7eviD6iUfhMismSJvxHqQVwkjgcSDxRocfb4w3	INDokaOmhLAg6lthTpCnwYXxwolOiEcbwbbTc=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=content-type:subject:from:to:in-reply-to:references:date:message-id	:user-agent:content-transfer-encoding;	b=OOWmBtIjEHDzk+TOLD6wBXdmuHK6LJbVh1N0sPjJwl9aT7FklsBQ87Bo9yNMfF03uO	fL0k1wayetr4cbm+0aajTAAOJZc1gJGN71+b83/JMKrtz0Scy6VmII6GqqtRP4emNB/u	4rcThu3sW3+mPTkvpbALwyxV0OLgAfDDRWSBE=</li>
<li><em>In-reply-to</em>: &lt;1263483819-sup-9886@changeling.local&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;1263483819-sup-9886@changeling.local&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: Sup/git</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>This is a problematic place for this logic to go, since it appears as if 
the idle update does not fire when shelled to the editor, and instead fires 
immediately upon returning.  Which ironically is exactly when you're 
becoming unidle.

I'm thinking of an IdleManager with a single public method #ping that can 
be called here where no_keystrokes_since is being updated.  It has a thread 
that does the threshold checking and relays the updates.  This way it's not 
in the main thread and doesn't block when shelled.

Thoughts?

Excerpts from Eric Sherman's message of Thu Jan 14 10:45:54 -0500 2010:
&gt; ---
&gt;  bin/sup |   17 +++++++++++++++++
&gt;  1 files changed, 17 insertions(+), 0 deletions(-)
&gt; 
&gt; diff --git a/bin/sup b/bin/sup
&gt; index 19b2a87..0d90d00 100755
&gt; --- a/bin/sup
&gt; +++ b/bin/sup
&gt; @@ -260,6 +260,10 @@ begin
&gt;      SearchResultsMode.spawn_from_query $opts[:search]
&gt;    end
&gt;  
&gt; +  IDLE_THRESHOLD = 60
&gt; +  no_keystrokes_since = Time.now
&gt; +  idle = false
&gt; +
&gt;    until Redwood::exceptions.nonempty? || $die
&gt;      c = begin
&gt;        Ncurses.nonblocking_getch
&gt; @@ -274,9 +278,22 @@ begin
&gt;          debug &quot;redrawing screen on sigwinch&quot;
&gt;          BufferManager.completely_redraw_screen
&gt;        end
&gt; +
&gt; +      if !idle and Time.now.to_i - no_keystrokes_since.to_i &gt;= IDLE_THRESHOLD
&gt; +        UpdateManager.relay self, :idle, Time.at(no_keystrokes_since)
&gt; +        idle = true
&gt; +      end
&gt; +
&gt;        next
&gt;      end
&gt;  
&gt; +    if idle
&gt; +      UpdateManager.relay self, :unidle, Time.at(no_keystrokes_since)
&gt; +      idle = false
&gt; +    end
&gt; +
&gt; +    no_keystrokes_since = Time.now
&gt; +
&gt;      if c == 410
&gt;        ## this is ncurses's way of telling us it's detected a refresh.
&gt;        ## since we have our own sigwinch handler, we don't do anything.
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01312" href="msg01312.html">[sup-devel] [PATCHv2] idle and unidle updates</a></strong>
<ul><li><em>From:</em> Eric Sherman &lt;hyperbolist@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01162.html">Re: [sup-devel] [PATCH] fix textfield truncation</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01209.html">[sup-devel] [PATCH] configurable color highlights</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01312.html">[sup-devel] [PATCHv2] idle and unidle updates</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01235.html">[sup-devel] [PATCHv4] [issue14] poll updates accumulate while idle</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01201"><strong>Date</strong></a></li>
<li><a href="threads.html#01201"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

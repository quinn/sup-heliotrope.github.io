<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;devel] after second heliotrope import,	new messages not appearing -->
<!--X-From-R13: [ngguvrh Dnxbgbwnban <zngguvrh.enxbgbwnbanNtznvy.pbz> -->
<!--X-Date: Wed, 2 Jan 2013 12:52:42 &#45;0800 (PST) -->
<!--X-Message-Id: CAMiZLn2CNtF+9YULy9mXJKi0HVNXh9TJPuypjN4mfKC058HiVQ@mail.gmail.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: CAOxvSbextWLEObcKrU&#45;93SzFqnhZ&#45;up7cV6MwUboFgN2TM7GNw@mail.gmail.com -->
<!--X-Reference: CAMiZLn1Uv&#45;5Csf7O2kxijbwanVsT78W4puy_ypN0vMr=3mA0Yg@mail.gmail.com -->
<!--X-Reference: CAOxvSbcBPGCsL_ZDqMgi6zk2uodnLqrdh89SkzMFg=F8aYdCHA@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-devel] after second heliotrope import,	new messages not appearing</title>
<link rev="made" href="mailto:matthieu.rakotojaona@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00361.html">Date Prev</a>][<a href="msg00100.html">Date Next</a>][<a href="msg00361.html">Thread Prev</a>][<a href="msg00100.html">Thread Next</a>][<a href="maillist.html#00060">Date Index</a>][<a href="threads.html#00060">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-devel] after second heliotrope import,	new messages not appearing</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-devel] after second heliotrope import,	new messages not appearing</li>
<li><em>From</em>: Matthieu Rakotojaona &lt;<a href="mailto:matthieu.rakotojaona%40gmail.com">matthieu.rakotojaona@gmail.com</a>&gt;</li>
<li><em>Date</em>: Wed, 2 Jan 2013 21:47:06 +0100</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 50.56.192.79 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:in-reply-to:references:from:date:message-id:subject:to	:content-type; bh=DVkwDO/MgR6jr2zt+tUidxxBGDwgKWPaBs5w/KijQYg=;	b=etRXEu2PJ57jJhqp0fdF+pApxi6JIHpXV6uZTsSG1goV4mL+ns64eL3GYK5uzVGwTT	VxpwquGVS3ZQGkMd3ZGxA+8gV+D/X2wtl9zlYYVLltPWBTlzwdQNpjiqcqtttiM3Bg3k	45wLVP+VhuDilnsYrACPCU7TxmsoFUkwkDKW4qwrSlSGo1jrJ6FqNL5vdwUQ8ZfgNIZG	IFNV6VDeVa90DzWav+8bvhIVvu/AbHKNJs96cqeVQsyaAInlMHDAEpBAXxa3XTcmoapE	8Lm0dgMQY4ChbA8l9kaP4SwGo+MliK1pKMQ4TNB9Uu8D2hdSm443VZHJ62L+Oci1nDXO	Zi4A==</li>
<li><em>In-reply-to</em>: &lt;CAOxvSbcBPGCsL_ZDqMgi6zk2uodnLqrdh89SkzMFg=F8aYdCHA@mail.gmail.com&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg00130.html">CAOxvSbextWLEObcKrU-93SzFqnhZ-up7cV6MwUboFgN2TM7GNw@mail.gmail.com</a>&gt;	&lt;CAMiZLn1Uv-5Csf7O2kxijbwanVsT78W4puy_ypN0vMr=3mA0Yg@mail.gmail.com&gt;	&lt;CAOxvSbcBPGCsL_ZDqMgi6zk2uodnLqrdh89SkzMFg=F8aYdCHA@mail.gmail.com&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<div dir="ltr">So, it appears heliotrope tells you your mails are indexed, yet they don&#39;t appear. All I see is `MetaIndex#add_message` returning in the test that checks if the mail is already in the store. Problem is, the exact same check is already done before that moment, and if the mail really was already present, it should be marked as &quot;seen&quot; and not &quot;indexed&quot;.<div>



<br></div><div>Another possibility could be `MetaIndex#gen_new_docid` which, for an unknown reason, returns a wrong value, so it would always overwrite an old message.</div><div><br></div><div>I&#39;m not really good at debugging efficiently, but I would re-launch the import after having placed a few &quot;puts&quot; in this `add_message` method, see if the existence test returns true or not. If not, print the docid, and see what the message with that docid is. If the message with that docid is the one you just imported, then there is a problem with how we generate them (because it was already given to another message).</div>


</div><div class="gmail_extra"><br><br><div class="gmail_quote">On Tue, Jan 1, 2013 at 7:33 PM, Hamish D <span dir="ltr">&lt;<a rel="nofollow" href="mailto:dmishd@gmail.com" target="_blank">dmishd@gmail.com</a>&gt;</span> wrote:<br><blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

<div class="im">&gt; Your problem may have multiple origins, and I have no idea where you could<br>
&gt; start :<br>
&gt;<br>
&gt; - Did you use the correct directories for messages and index for _both_ the<br>
&gt; import and the server ? (sorry if this sounds stupid)<br>
<br>
</div>Always good to check the basics, but yes, I do use the same directory.<br>
I have scripts for the import and the server and both use the -d<br>
argument to ensure they use the same directory.<br>
<div class="im"><br>
&gt; - Did the index size in heliotrope change ? (as given by a GET to<br>
&gt; /size.json)<br>
<br>
</div>No - it remained the same. (And is about half of the count that sup reports).<br>
<div class="im"><br>
&gt; - Did the messages file size change ?<br>
<br>
</div>It did on one import, but not the most recent.<br>
<div class="im"><br>
&gt; - Are the messages absent in inbox only or from the whole turnsole ?<br>
<br>
</div>All searches that I do stop in May.<br>
<div class="im"><br>
&gt; - As a last resort, could you send the mbox file so that I can try this at<br>
&gt; home, if your mails aren&#39;t too personal ?<br>
<br>
</div>It&#39;s my work email, with a total of over 100,000 messages. So I&#39;d<br>
prefer not to send it over.<br>
<br>
Any logs that might be worth looking at? While doing the import, I do<br>
get various lines along the line of:<br>
<br>
&#xA0; &#xA0; ; scanned 71, indexed 71, skipped 0 bad and 0 seen messages in<br>
22.1s = 3.2 m/s<br>
<br>
I do use the state argument (-t) to save reimporting old mail. I have<br>
also tried doing a reindex (as I import from multiple mboxes) but to<br>
no avail.<br>
<br>
I could just try another import of the whole lot into a clean directory I guess.<br>
<br>
I&#39;m also happy to type stuff into heliotrope-console if that will help<br>
diagnose stuff.<br>
<br>
Thanks for your suggestions so far<br>
<span class="HOEnZb"><font color="#888888">Hamish<br>
</font></span><div class="HOEnZb"><div class="h5"><br>
<br>
&gt; On Thu, Dec 27, 2012 at 5:19 PM, Hamish D &lt;<a rel="nofollow" href="mailto:dmishd@gmail.com">dmishd@gmail.com</a>&gt; wrote:<br>
&gt;&gt;<br>
&gt;&gt; Hello<br>
&gt;&gt;<br>
&gt;&gt; I&#39;ve just been trying to carry on from where I left off with migrating<br>
&gt;&gt; my work email into heliotrope (which I last worked on in May).<br>
&gt;&gt;<br>
&gt;&gt; So I&#39;ve rsynced the mbox files across to where I will run heliotrope<br>
&gt;&gt; and tried running heliotrope-import to put all the new messages in the<br>
&gt;&gt; index. It appeared to work properly, reporting that messages were<br>
&gt;&gt; being added to the index and the index files themselves have had their<br>
&gt;&gt; timestamps updated. But when I start turnsole, I can&#39;t find any email<br>
&gt;&gt; after May.<br>
&gt;&gt;<br>
&gt;&gt; Any ideas on where to start looking to work out what is going on?<br>
&gt;&gt;<br>
&gt;&gt; Hamish<br>
_______________________________________________<br>
Sup-devel mailing list<br>
<a rel="nofollow" href="mailto:Sup-devel@rubyforge.org">Sup-devel@rubyforge.org</a><br>
<a rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel" target="_blank">http://rubyforge.org/mailman/listinfo/sup-devel</a><br>
</div></div></blockquote></div><br><br clear="all"><div><br></div>-- <br>Matthieu RAKOTOJAONA<br>
</div>
<pre>_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00130" href="msg00130.html">[sup-devel] after second heliotrope import,	new messages not appearing</a></strong>
<ul><li><em>From:</em> Hamish D &lt;dmishd@gmail.com&gt;</li></ul></li>
<li><strong><a name="00312" href="msg00312.html">Re: [sup-devel] after second heliotrope import,	new messages not appearing</a></strong>
<ul><li><em>From:</em> Matthieu Rakotojaona &lt;matthieu.rakotojaona@gmail.com&gt;</li></ul></li>
<li><strong><a name="00361" href="msg00361.html">Re: [sup-devel] after second heliotrope import,	new messages not appearing</a></strong>
<ul><li><em>From:</em> Hamish D &lt;dmishd@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00361.html">Re: [sup-devel] after second heliotrope import,	new messages not appearing</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00100.html">[sup-talk] Github organization for sup and heliotrope</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00361.html">Re: [sup-devel] after second heliotrope import,	new messages not appearing</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00100.html">[sup-talk] Github organization for sup and heliotrope</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00060"><strong>Date</strong></a></li>
<li><a href="threads.html#00060"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

<!-- MHonArc v2.6.18 -->
<!--X-Subject: [sup&#45;devel] [PATCH] put the heliotrope client into the Heliotrope	namespace -->
<!--X-From-R13: Hvivra Rvqrybg <ivivra.qvqrybgNtznvy.pbz> -->
<!--X-Date: Thu, 23 Jun 2011 23:30:46 &#45;0700 (PDT) -->
<!--X-Message-Id: 1308894567&#45;7174&#45;2&#45;git&#45;send&#45;email&#45;vivien.didelot@gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1308894567&#45;7174&#45;1&#45;git&#45;send&#45;email&#45;vivien.didelot@gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[sup-devel] [PATCH] put the heliotrope client into the Heliotrope	namespace</title>
<link rev="made" href="mailto:vivien.didelot@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00347.html">Date Prev</a>][<a href="msg00305.html">Date Next</a>][<a href="msg00347.html">Thread Prev</a>][<a href="msg00305.html">Thread Next</a>][<a href="maillist.html#00385">Date Index</a>][<a href="threads.html#00385">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sup-devel] [PATCH] put the heliotrope client into the Heliotrope	namespace</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:William%40rubyforge.org">William@rubyforge.org</a>, <a href="mailto:Morgan%40rubyforge.org">Morgan@rubyforge.org</a>,	<a href="mailto:wmorgan-sup%40masanjin.net">wmorgan-sup@masanjin.net</a></li>
<li><em>Subject</em>: [sup-devel] [PATCH] put the heliotrope client into the Heliotrope	namespace</li>
<li><em>From</em>: Vivien Didelot &lt;<a href="mailto:vivien.didelot%40gmail.com">vivien.didelot@gmail.com</a>&gt;</li>
<li><em>Date</em>: Fri, 24 Jun 2011 01:49:27 -0400</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Cc</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:from:to:cc:subject:date:message-id:x-mailer	:in-reply-to:references;	bh=sMFKlQj6onu369VQSzO698OYoeUJ+O0GBt/gMGgccb4=;	b=Hny92TsiRElB9AqXOTyARRTF1t84Eq60aZiMtan7GmjdE/2h4qlm55QKmGZU/RYukO	M0WN+eUzsvJRvnp3gw03aMy4KGl/ozNiSW/BP1TsfPUh446EXnLyTy2h3l7kvvmdB2Sx	imIR7RtIy66LMMO9BXqcFcDt1+kxVMzw9SUFQ=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=from:to:cc:subject:date:message-id:x-mailer:in-reply-to:references;	b=EpHY+FR3oYASXj2GbxxbfaWhtzsqpVZgscIpp1/w1UFFL2+UoEvY6SBlFLr/OqczYk	4Wu/srL8G6J+Lin2HYiKm4zEacBZrQuolMLTT61XJfKFOZ3bcjJYhfQVzh3R+Ziy2GJt	KWM2aLCAGviMVsoVy+9qmgwv3DXavAuR8lDmE=</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00347.html">1308894567-7174-1-git-send-email-vivien.didelot@gmail.com</a>&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg00347.html">1308894567-7174-1-git-send-email-vivien.didelot@gmail.com</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi William,

To start working on Turnsole,I think putting heliotrope-client
under the Heliotrope namespace in a good start, to avoid
confusion.

This first patch is for the Heliotrope project. It moves
lib/heliotrope-client.rb to lib/heliotrope/client.rb

Another patch is sent with this email to update the Turnsole
client.

Signed-off-by: Vivien Didelot &lt;vivien.didelot@gmail.com&gt;
---
 README                   |    2 +-
 lib/heliotrope-client.rb |  102 ---------------------------------------------
 lib/heliotrope/client.rb |  104 ++++++++++++++++++++++++++++++++++++++++++++++
 lib/heliotrope/index.rb  |    2 +-
 4 files changed, 106 insertions(+), 104 deletions(-)
 delete mode 100644 lib/heliotrope-client.rb
 create mode 100644 lib/heliotrope/client.rb

diff --git a/README b/README
index ff82c1d..639e2c2 100644
--- a/README
+++ b/README
@@ -92,4 +92,4 @@ procmailrc or whatever.
 JSON API SPEC
 -------------
 
-Coming soon! For now, you can reverse engineer lib/heliotrope-client.rb.
+Coming soon! For now, you can reverse engineer lib/heliotrope/client.rb.
diff --git a/lib/heliotrope-client.rb b/lib/heliotrope-client.rb
deleted file mode 100644
index 5b3a4bd..0000000
--- a/lib/heliotrope-client.rb
+++ /dev/null
@@ -1,102 +0,0 @@
-require 'rubygems'
-require 'rest_client'
-require 'json'
-
-class HeliotropeClient
-  class Error &lt; StandardError; end
-
-  MESSAGE_MUTABLE_STATE = Set.new %w(starred unread deleted)
-  MESSAGE_IMMUTABLE_STATE = Set.new %w(attachment signed encrypted draft sent)
-  MESSAGE_STATE = MESSAGE_MUTABLE_STATE + MESSAGE_IMMUTABLE_STATE
-
-  attr_reader :url
-  def initialize url
-    @url = url
-    @resource = RestClient::Resource.new url
-  end
-
-  def search query, num=20, start=0
-    v = get_json &quot;search&quot;, :q =&gt; query, :start =&gt; start, :num =&gt; num
-    v[&quot;results&quot;]
-  end
-
-  def count query
-    get_json(&quot;count&quot;, :q =&gt; query)[&quot;count&quot;]
-  end
-
-  def thread id; get_json(&quot;thread/#{id}&quot;)[&quot;messageinfos&quot;] end
-  def threadinfo id; get_json(&quot;thread/#{id}/info&quot;) end
-
-  def message id, preferred_mime_type=&quot;text/plain&quot;
-    get_json &quot;message/#{id}&quot;, :mime_type_pref =&gt; preferred_mime_type
-  end
-
-  def send_message message, opts={}
-    post_json &quot;message/send&quot;, :message =&gt; message, :labels =&gt; (opts[:labels] || []).to_json
-  end
-
-  def message_part message_id, part_id
-    ## not a json blob, but a binary region
-    @resource[&quot;message/#{message_id}/part/#{part_id}&quot;].get
-  end
-
-  def raw_message message_id
-    ## not a json blob, but a binary region
-    @resource[&quot;message/#{message_id}/raw&quot;].get
-  end
-
-  def labels; get_json(&quot;labels&quot;)[&quot;labels&quot;] end
-  def info; get_json(&quot;info&quot;) end
-  def size; get_json(&quot;size&quot;)[&quot;size&quot;] end
-
-  def prune_labels!; post_json(&quot;labels/prune&quot;)[&quot;labels&quot;] end
-
-  def set_labels! thread_id, labels
-    post_json &quot;thread/#{thread_id}/labels&quot;, :labels =&gt; labels.to_json
-  end
-
-  def set_state! message_id, state
-    post_json &quot;message/#{message_id}/state&quot;, :state =&gt; state.to_json
-  end
-
-  def set_thread_state! thread_id, state
-    post_json &quot;thread/#{thread_id}/state&quot;, :state =&gt; state.to_json
-  end
-
-private
-
-  def get_json path, params={}
-    handle_errors do
-      response = @resource[path + &quot;.json&quot;].get :params =&gt; params
-      response.force_encoding Encoding::UTF_8 if in_ruby19_hell?
-      JSON.parse response
-    end
-  end
-
-  def post_json path, params={ :please =&gt; &quot;1&quot; } # you need to have at least one param for RestClient to work... lame
-    handle_errors do
-      response = @resource[path + &quot;.json&quot;].post params
-      response.force_encoding Encoding::UTF_8 if in_ruby19_hell?
-      JSON.parse response
-    end
-  end
-
-  def handle_errors
-    begin
-      v = yield
-      raise Error, &quot;invalid response: #{v.inspect[0..200]}&quot; unless v.is_a?(Hash)
-      case v[&quot;response&quot;]
-        when &quot;ok&quot;; v
-        when &quot;error&quot;; raise Error, v[&quot;message&quot;]
-        else raise Error, &quot;invalid response: #{v.inspect[0..200]}&quot;
-      end
-    rescue SystemCallError, RestClient::Exception, JSON::ParserError =&gt; e
-      raise Error, &quot;#{e.message} (#{e.class})&quot;
-    end
-  end
-
-  def in_ruby19_hell?
-    @in_ruby19_hell = &quot;&quot;.respond_to?(:encoding) if @in_ruby19_hell.nil?
-    @in_ruby19_hell
-  end
-end
diff --git a/lib/heliotrope/client.rb b/lib/heliotrope/client.rb
new file mode 100644
index 0000000..386efc9
--- /dev/null
+++ b/lib/heliotrope/client.rb
@@ -0,0 +1,104 @@
+require 'rubygems'
+require 'rest_client'
+require 'json'
+
+module Heliotrope
+class Client
+  class Error &lt; StandardError; end
+
+  MESSAGE_MUTABLE_STATE = Set.new %w(starred unread deleted)
+  MESSAGE_IMMUTABLE_STATE = Set.new %w(attachment signed encrypted draft sent)
+  MESSAGE_STATE = MESSAGE_MUTABLE_STATE + MESSAGE_IMMUTABLE_STATE
+
+  attr_reader :url
+  def initialize url
+    @url = url
+    @resource = RestClient::Resource.new url
+  end
+
+  def search query, num=20, start=0
+    v = get_json &quot;search&quot;, :q =&gt; query, :start =&gt; start, :num =&gt; num
+    v[&quot;results&quot;]
+  end
+
+  def count query
+    get_json(&quot;count&quot;, :q =&gt; query)[&quot;count&quot;]
+  end
+
+  def thread id; get_json(&quot;thread/#{id}&quot;)[&quot;messageinfos&quot;] end
+  def threadinfo id; get_json(&quot;thread/#{id}/info&quot;) end
+
+  def message id, preferred_mime_type=&quot;text/plain&quot;
+    get_json &quot;message/#{id}&quot;, :mime_type_pref =&gt; preferred_mime_type
+  end
+
+  def send_message message, opts={}
+    post_json &quot;message/send&quot;, :message =&gt; message, :labels =&gt; (opts[:labels] || []).to_json
+  end
+
+  def message_part message_id, part_id
+    ## not a json blob, but a binary region
+    @resource[&quot;message/#{message_id}/part/#{part_id}&quot;].get
+  end
+
+  def raw_message message_id
+    ## not a json blob, but a binary region
+    @resource[&quot;message/#{message_id}/raw&quot;].get
+  end
+
+  def labels; get_json(&quot;labels&quot;)[&quot;labels&quot;] end
+  def info; get_json(&quot;info&quot;) end
+  def size; get_json(&quot;size&quot;)[&quot;size&quot;] end
+
+  def prune_labels!; post_json(&quot;labels/prune&quot;)[&quot;labels&quot;] end
+
+  def set_labels! thread_id, labels
+    post_json &quot;thread/#{thread_id}/labels&quot;, :labels =&gt; labels.to_json
+  end
+
+  def set_state! message_id, state
+    post_json &quot;message/#{message_id}/state&quot;, :state =&gt; state.to_json
+  end
+
+  def set_thread_state! thread_id, state
+    post_json &quot;thread/#{thread_id}/state&quot;, :state =&gt; state.to_json
+  end
+
+private
+
+  def get_json path, params={}
+    handle_errors do
+      response = @resource[path + &quot;.json&quot;].get :params =&gt; params
+      response.force_encoding Encoding::UTF_8 if in_ruby19_hell?
+      JSON.parse response
+    end
+  end
+
+  def post_json path, params={ :please =&gt; &quot;1&quot; } # you need to have at least one param for RestClient to work... lame
+    handle_errors do
+      response = @resource[path + &quot;.json&quot;].post params
+      response.force_encoding Encoding::UTF_8 if in_ruby19_hell?
+      JSON.parse response
+    end
+  end
+
+  def handle_errors
+    begin
+      v = yield
+      raise Error, &quot;invalid response: #{v.inspect[0..200]}&quot; unless v.is_a?(Hash)
+      case v[&quot;response&quot;]
+        when &quot;ok&quot;; v
+        when &quot;error&quot;; raise Error, v[&quot;message&quot;]
+        else raise Error, &quot;invalid response: #{v.inspect[0..200]}&quot;
+      end
+    rescue SystemCallError, RestClient::Exception, JSON::ParserError =&gt; e
+      raise Error, &quot;#{e.message} (#{e.class})&quot;
+    end
+  end
+
+  def in_ruby19_hell?
+    @in_ruby19_hell = &quot;&quot;.respond_to?(:encoding) if @in_ruby19_hell.nil?
+    @in_ruby19_hell
+  end
+end
+end
diff --git a/lib/heliotrope/index.rb b/lib/heliotrope/index.rb
index 48ea09e..197ba91 100644
--- a/lib/heliotrope/index.rb
+++ b/lib/heliotrope/index.rb
@@ -33,7 +33,7 @@ class Index
   MESSAGE_IMMUTABLE_STATE = Set.new %w(attachment signed encrypted draft sent)
   MESSAGE_STATE = MESSAGE_MUTABLE_STATE + MESSAGE_IMMUTABLE_STATE
   ## if you change any of those state things, be sure to update
-  ## heliotrope-client as well.
+  ## heliotrope/client as well.
 
   SNIPPET_MAX_SIZE = 100 # chars
 
-- 
1.7.5.4

_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00347" href="msg00347.html">[sup-devel] [PATCH] update Heliotrope client requirement</a></strong>
<ul><li><em>From:</em> Vivien Didelot &lt;vivien.didelot@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00347.html">[sup-devel] [PATCH] update Heliotrope client requirement</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00305.html">[sup-devel] try heliotrope!</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00347.html">[sup-devel] [PATCH] update Heliotrope client requirement</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00305.html">[sup-devel] try heliotrope!</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00385"><strong>Date</strong></a></li>
<li><a href="threads.html#00385"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

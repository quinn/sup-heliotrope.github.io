<!-- MHonArc v2.6.18 -->
<!--X-Subject: [sup&#45;devel] couple more gpg related patches -->
<!--X-From-R13: Vnzvfu R <qzvfuqNtznvy.pbz> -->
<!--X-Date: Thu, 3 Feb 2011 15:53:37 &#45;0800 (PST) -->
<!--X-Message-Id: AANLkTiki8LbxGaCLO0m8ENTF_0bMdJfwWyhDTBscrDLq@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[sup-devel] couple more gpg related patches</title>
<link rev="made" href="mailto:dmishd@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00681.html">Date Prev</a>][<a href="msg00698.html">Date Next</a>][<a href="msg00683.html">Thread Prev</a>][<a href="msg00698.html">Thread Next</a>][<a href="maillist.html#00604">Date Index</a>][<a href="threads.html#00604">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sup-devel] couple more gpg related patches</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: [sup-devel] couple more gpg related patches</li>
<li><em>From</em>: Hamish D &lt;<a href="mailto:dmishd%40gmail.com">dmishd@gmail.com</a>&gt;</li>
<li><em>Date</em>: Thu, 3 Feb 2011 23:27:18 +0000</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:date:message-id:subject:from:to	:content-type; bh=DPJlchUPvcvnezrU/wNeTY9+UnMcW3eSbPsX/w2ZCwc=;	b=lRNKtyt1WSp0hEmr8CIuOlXUDZXvg1eO9OHd9fIS0h6zKZfALVK0rF2hW//5r9C+0o	e/oFIXpaxtfCsEA0liU3ccn0DZMbTg9FBUWEptTj3m2/8wqe1V+tdTNfVPzcgg8uDOTj	QjYz12GWscU1yR2HYZ39OTjl314XK8b6s/NxQ=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=mime-version:date:message-id:subject:from:to:content-type;	b=SeAxFXVFN/Yz0Yiv/NWa0IfGfGeh2BDXbHLsp7iPwS+m7wTh97CyhGvMagod7t/PLN	9q9rNf0XZc7j2BXNPrpMKXLfQ6cf+kQAX3P3UZziu+/3IkZRNVVoa4T7lJkt6/kmkxSq	9c8W22B9KlY7MdWBoEfdOZng+WXFjl9lSoeNY=</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>I've uploaded a couple more patches to the gpgme branch and merged
them into next:

* one fixes the fingerprint of untrusted keys
* the other adds &quot;untrusted&quot; to the signature summary line when the
key is untrusted - ie when there is no web of trust from you to that
key.

Patches below for your reading pleasure. Someone tell me if you'd
rather have less detail from me.

Hamish Downer


commit 6f1b9d7e94496543eacc63807b99fa29059ed300
Author: Hamish Downer &lt;dmishd@gmail.com&gt;
Date:   Wed Feb 2 21:06:22 2011 +0000

    show the FULL key fingerprint, not just the first half

diff --git a/lib/sup/crypto.rb b/lib/sup/crypto.rb
index 967c09e..978e145 100644
--- a/lib/sup/crypto.rb
+++ b/lib/sup/crypto.rb
@@ -313,7 +313,7 @@ private
       if signature.validity != GPGME::GPGME_VALIDITY_FULL &amp;&amp;
signature.validity != GPGME::GPGME_VALIDITY_MARGINAL
         output_lines &lt;&lt; &quot;WARNING: This key is not certified with a
trusted signature!&quot;
         output_lines &lt;&lt; &quot;There is no indication that the signature
belongs to the owner&quot;
-        output_lines &lt;&lt; &quot;Full fingerprint is: &quot; + (0..9).map {|i|
signature.fpr[(i*2),2]}.join(&quot;:&quot;)
+        output_lines &lt;&lt; &quot;Full fingerprint is: &quot; + (0..9).map {|i|
signature.fpr[(i*4),4]}.join(&quot;:&quot;)
       else
         trusted = true
       end



commit 0e1f5e56dc7063104c52f1b2d03a3fd85573bc47
Author: Hamish Downer &lt;dmishd@gmail.com&gt;
Date:   Wed Feb 2 21:02:05 2011 +0000

    signature summary now states &quot;untrusted&quot; if the signing key is not trusted

diff --git a/lib/sup/crypto.rb b/lib/sup/crypto.rb
index 5a38f27..967c09e 100644
--- a/lib/sup/crypto.rb
+++ b/lib/sup/crypto.rb
@@ -153,16 +153,18 @@ EOS
       end
     end

+    summary_line =
simplify_sig_line(verify_result.signatures[0].to_s, all_trusted)
+
     if all_output_lines.length == 0
       Chunk::CryptoNotice.new :valid, &quot;Encrypted message wasn't
signed&quot;, all_output_lines
     elsif valid
       if all_trusted
-        Chunk::CryptoNotice.new(:valid,
simplify_sig_line(verify_result.signatures[0].to_s), all_output_lines)
+        Chunk::CryptoNotice.new(:valid, summary_line, all_output_lines)
       else
-        Chunk::CryptoNotice.new(:valid_untrusted,
simplify_sig_line(verify_result.signatures[0].to_s), all_output_lines)
+        Chunk::CryptoNotice.new(:valid_untrusted, summary_line,
all_output_lines)
       end
     elsif !unknown
-      Chunk::CryptoNotice.new(:invalid,
simplify_sig_line(verify_result.signatures[0].to_s), all_output_lines)
+      Chunk::CryptoNotice.new(:invalid, summary_line, all_output_lines)
     else
       unknown_status all_output_lines
     end
@@ -274,8 +276,12 @@ private
   end

   # remove the hex key_id and info in ()
-  def simplify_sig_line sig_line
-    sig_line.sub(/from [0-9A-F]{16} /, &quot;from &quot;)
+  def simplify_sig_line sig_line, trusted
+    sig_line.sub!(/from [0-9A-F]{16} /, &quot;from &quot;)
+    if !trusted
+      sig_line.sub!(/Good signature/, &quot;Good (untrusted) signature&quot;)
+    end
+    sig_line
   end

   def sig_output_lines signature
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00681.html">Re: [sup-devel] Bug: UTF-8 error when sending messages</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00698.html">[sup-devel] Branch maildir-sync</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00683.html">[sup-devel] more gpgme fixes</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00698.html">[sup-devel] Branch maildir-sync</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00604"><strong>Date</strong></a></li>
<li><a href="threads.html#00604"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

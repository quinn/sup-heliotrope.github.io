<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;devel] A maildir root source: syncing labels with maildirs	(imap folders) -->
<!--X-From-R13: Egrira Epuzrvfre <fgriraNfpuzrvfre.bet> -->
<!--X-Date: Tue, 26 Nov 2013 06:44:00 &#45;0800 (PST) -->
<!--X-Message-Id: 1385476504&#45;sup&#45;9378@indy.local -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1385392376&#45;sup&#45;8491@qwerzila -->
<!--X-Reference: 1385415206&#45;sup&#45;5054@qwerzila -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-devel] A maildir root source: syncing labels with maildirs	(imap folders)</title>
<link rev="made" href="mailto:steven@schmeiser.org">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00059.html">Date Prev</a>][<a href="msg00186.html">Date Next</a>][<a href="msg00059.html">Thread Prev</a>][<a href="msg00186.html">Thread Next</a>][<a href="maillist.html#00269">Date Index</a>][<a href="threads.html#00269">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-devel] A maildir root source: syncing labels with maildirs	(imap folders)</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sup-devel &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-devel] A maildir root source: syncing labels with maildirs	(imap folders)</li>
<li><em>From</em>: Steven Schmeiser &lt;<a href="mailto:steven%40schmeiser.org">steven@schmeiser.org</a>&gt;</li>
<li><em>Date</em>: Tue, 26 Nov 2013 09:43:49 -0500</li>
<li><em>Authentication-results</em>: mx.google.com;       spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 50.56.192.79 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>;       dkim=neutral (bad format) header.i=@schmeiser.org</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=simple/simple; d=schmeiser.org;	s=default; t=1385477030;	bh=IQoc8vujEvrspCcKZr+506QV40diwXcr7CLyL18iuxQ=;	h=From:To:Subject:In-reply-to:References:Date:From;	b=WtRxXM3cVw01+WdX6ppwF0/kPH299up+U/dkVsHjhQyUz85d3C/VEaZbabu1TZmjI	0/xc/XvFoYM2CQU/3pOzRo9WMrIoeroH+eesjkuGsXIV6RPb8YBXu9MAKq66zPrFmE	qnCrruWIKeYZh96tacJG/aS92teAvmcyQ4BKT6Qw=</li>
<li><em>In-reply-to</em>: &lt;1385415206-sup-5054@qwerzila&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;1385392376-sup-8491@qwerzila&gt; &lt;1385415206-sup-5054@qwerzila&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: Sup/git</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>I've installed the branch and am trying it out.  So far it looks good, but there have been a few oddities...

I'm running with a standard IMAP account (not Gmail).  The root looks like

[steve@indy ~]$ ls -l .mail
total 0
drwx------  5 steve  staff  170 Nov 19 13:44 Archive
drwx------  5 steve  staff  170 Nov 22 12:31 INBOX
drwx------  5 steve  staff  170 Nov 19 13:44 drafts
drwx------  5 steve  staff  170 Nov 19 13:44 econpapers
drwx------  5 steve  staff  170 Nov 19 13:44 sent
drwx------  5 steve  staff  170 Nov 19 13:44 spam
drwx------  5 steve  staff  170 Nov 25 19:25 trash

and my sources are configured as follows

[steve@indy ~]$ more .sup/sources.yaml
---
- !supmua.org,2006-10-01/Redwood/MaildirRoot
  uri: maildirroot:///Users/steve/.mail
  usual: true
  archived: false
  id: 1
  labels: []
  sync_back: true
  confirm_enable_experimental: true
  maildir_creation_allowed: true
  inbox_folder: INBOX
  sent_folder: sent
  drafts_folder: drafts
  spam_folder: spam
  trash_folder: trash
  archive_folder: Archive
- !supmua.org,2006-10-01/Redwood/SentLoader{}

I had around 40k messages in the Archive folder and ~20 in the INBOX.  After sup-sync, around 10k of the messages in Archive were moved into sup's inbox with labels 'INBOX' and 'Inbox'.  They were also (incorrectly) marked as unread.

I'll keep experimenting.  Thanks for your effort -- I think this is a great new feature and would really like to see it merged into the mainline someday.

Steve


&gt; Hi,
&gt; 
&gt; I have attached my relevant configs (and hopefully managed to anonymize
&gt; them enough). As you can see I use the 'utf7.py' module (placed in
&gt; ~/.offlineimap/) to decode/encode between imap4-utf-7 and utf-8 on
&gt; system (if your filesystem uses a different encoding you might have
&gt; issues). Please don't use the configs verbatim, but rather as
&gt; inspiration: I might have cut out important parts. Some of this is
&gt; in the wiki.
&gt; 
&gt; Some of the folders are translated (bi-directional of course) in my
&gt; offlineimaprc, but if you check out my sources.yaml you will see that I
&gt; have specified which folders are related to special (deleted, starred,
&gt; inbox, etc) for some of the sources.
&gt; 
&gt; My translation setup in offlineimaprc for my first GMail account
&gt; corresponds to the default values the maildirroot source suggests. The
&gt; only relevant change in config.yaml is to set sync_back_to_maildir:
&gt; true.
&gt; 
&gt; The way I set up sup with maildirroot is:
&gt; $ sup-config
&gt; 
&gt; fill in, don't add any sources. If you have a working config.yaml, you
&gt; can use it.
&gt; 
&gt; add sources:
&gt; $ sup-add maildirroot:///home/gaute/.mail/imap_account
&gt; 
&gt; I edit ~/.sup/sources.yaml and enable:
&gt; - confirm_enable_experimental: true
&gt; - sync_back: true
&gt; - maildir_creation_allowed: true
&gt; 
&gt; and tweak the folder names if necessary.
&gt; 
&gt; Then if your index is empty (you _cannot_ merge an existing maildir
&gt; source by using the same source id) - I run sup-sync:
&gt; $ sup-sync -v
&gt; 
&gt; Note that sup-sync does not support the :updated flag (when a message
&gt; has moved on disk), for that you have to run regular Sup and do a poll.
&gt; sup-sync scans through and adds labels; you can also just start up sup
&gt; and see what happens, but that takes a longer time: you probably do not
&gt; need to enable the stuff in sources.yaml before after sup-sync if you
&gt; are nervous (I would be!). 
&gt; 
&gt; Some annoying issues:
&gt; - deleting a maildir is hard:
&gt;   * if you delete it remotely it will be recreated by offlineimap (i
&gt;     think)
&gt;   * you have to first remove all emails remotely, sync sup, to make sure
&gt;     labels are removed.
&gt;   * if you remove all messages from a label the maildir will be empty,
&gt;     to delete the maildir: sync, delete the maildir locally + delete it
&gt;     remotely; then re-sync.
&gt; 
&gt;     this is the behaviour of offlineimap, but I think it is hard to do
&gt;     it differently. this means that if you accidentally add a bogus
&gt;     label, it is a bit of a pain to get rid of the maildir.
&gt; 
&gt; 
&gt; - if a message is deleted from the inbox remotely (archived) it is not
&gt;   removed from the inbox view (or any thread index view it is visible
&gt;   in) before sup is restarted.
&gt; 
&gt; To test maildirroot:
&gt; checkout my branch; make the gem: $ rake gem and install it: $ gem
&gt; install pkg/sup-999.gem. If develop has changed you can try to merge it in
&gt; first.
&gt; 
&gt; Again; please make a backup copy of your .mail so that you can restore
&gt; it if it turns out maildirroot has been eating or multiplying emails :)
&gt; 
&gt; I probably don't have the time to difficult bugs, but I would be happy
&gt; to accept patches and I could also put this branch on official Sup if it
&gt; turns out to be worth something.
&gt; 
&gt; 
&gt; Cheers, Gaute
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00186" href="msg00186.html">Re: [sup-devel] A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
<ul><li><em>From:</em> Gaute Hope &lt;eg@gaute.vetsj.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00057" href="msg00057.html">A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
<ul><li><em>From:</em> Gaute Hope &lt;eg@gaute.vetsj.com&gt;</li></ul></li>
<li><strong><a name="00140" href="msg00140.html">Re: A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
<ul><li><em>From:</em> Gaute Hope &lt;eg@gaute.vetsj.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00059.html">Re: A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00186.html">Re: [sup-devel] A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00059.html">Re: A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00186.html">Re: [sup-devel] A maildir root source: syncing labels with maildirs (imap folders)</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00269"><strong>Date</strong></a></li>
<li><a href="threads.html#00269"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

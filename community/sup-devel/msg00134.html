<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;devel] Tokyo Cabinet fails with invalid record header -->
<!--X-From-R13: Vbenpvb Enafba <ufnafbaNtznvy.pbz> -->
<!--X-Date: Wed, 22 Jun 2011 15:52:40 &#45;0700 (PDT) -->
<!--X-Message-Id: 201106230741.19602.hsanson@gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: BANLkTikNPaccz_Lhc_ws_pEUgRpQRwntjA@mail.gmail.com -->
<!--X-Reference: 1308610289&#45;sup&#45;7090@masanjin.net -->
<!--X-Reference: 1308713034&#45;sup&#45;9195@masanjin.net -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-devel] Tokyo Cabinet fails with invalid record header</title>
<link rev="made" href="mailto:hsanson@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00224.html">Date Prev</a>][<a href="msg00113.html">Date Next</a>][<a href="msg00338.html">Thread Prev</a>][<a href="msg00113.html">Thread Next</a>][<a href="maillist.html#00134">Date Index</a>][<a href="threads.html#00134">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-devel] Tokyo Cabinet fails with invalid record header</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-devel] Tokyo Cabinet fails with invalid record header</li>
<li><em>From</em>: Horacio Sanson &lt;<a href="mailto:hsanson%40gmail.com">hsanson@gmail.com</a>&gt;</li>
<li><em>Date</em>: Thu, 23 Jun 2011 07:41:19 +0900</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:from:organization:to:subject:date:user-agent	:references:in-reply-to:mime-version:x-uid:content-type	:content-transfer-encoding:message-id;	bh=2mXgQ8t5h77R3xyEIjVfVwf6WjrrMtASPTb6RpMnKqE=;	b=ulJv3cej3509cRrzzAlU5KSBT58i1e7PJN2sQ7P3lNMjLe1ZqN0G5vAMpVRKJ5yu7i	V22v+rTLbP/mO8KtlhwTHpYGeubHoVkdFd5lhGdBfNaL8ulfuH9W/ZhTcPJko9P+OW9K	Si9LTsG42s/yCu828cCzE0q6JlX2AUUTUMs/w=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=from:organization:to:subject:date:user-agent:references:in-reply-to	:mime-version:x-uid:content-type:content-transfer-encoding	:message-id;	b=Fp/uONtwjd6bY9FBjOsBhoijblKpHR1A/gkhnjsyqz0uZYO8KRlKkFz3KvI9jjFN/Q	nZcmCaoq+lTuPad+Rh3lzbMy5N3yMUJh/vUfdEyjFiNHYrWG8vl/UT4++BLfbRjU5hjV	5UsihRQ9lJPh2+8H3LCDi/hwGwKsaqNeQF3VE=</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00315.html">1308713034-sup-9195@masanjin.net</a>&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>Organization</em>: piaotech</li>
<li><em>References</em>: &lt;<a href="msg00365.html">BANLkTikNPaccz_Lhc_ws_pEUgRpQRwntjA@mail.gmail.com</a>&gt;	&lt;<a href="msg00070.html">1308610289-sup-7090@masanjin.net</a>&gt;	&lt;<a href="msg00315.html">1308713034-sup-9195@masanjin.net</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: KMail/1.13.6 (Linux/2.6.38-8-generic; KDE/4.6.4; x86_64; ; )</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>I left heliotrope-add running but it did not finished. I got some strange nil 
errors (see below):

I think this error happens when find_msgids is unable to find the message's id. 
Not sure what is the best action in this case but skipping it sounds a good 
option.
###################################################
; requesting messages 141445..141564 from imap server
scanned 130401, indexed 130278, skipped 25 bad and 98 seen messages in 9566.0s 
= 13.6 m/s
; requesting messages 141565..141688 from imap server
scanned 130501, indexed 130378, skipped 25 bad and 98 seen messages in 9572.0s 
= 13.6 m/s
/media/DATA/Apps/heliotrope/lib/heliotrope/message.rb:155:in `digest': can't 
convert nil into String (TypeError)
        from /media/DATA/Apps/heliotrope/lib/heliotrope/message.rb:155:in 
`hexdigest'
        from /media/DATA/Apps/heliotrope/lib/heliotrope/message.rb:155:in 
`munge_msgid'
        from /media/DATA/Apps/heliotrope/lib/heliotrope/message.rb:20:in 
`parse!'
        from bin/heliotrope-add:138:in `&lt;main&gt;'
####################################################


This error happens when @imap.uid_fetch doesn't raise any exception and 
returns nil instead of empty array. Was thinking to check for nil and set it
to an empty array if true but it would likely result in an infinite loop.
####################################################
; loading mail...
; connecting...
; login as horacio.sanson@gmail.com ...
; found 293004 new messages...
; found 293004 messages to scan
; requesting messages 283664..283763 from imap server
scanned 1, indexed 1, skipped 0 bad and 0 seen messages in 7.9s = 0.1 m/s
; requesting messages 283764..283863 from imap server
/media/DATA/Apps/heliotrope/lib/heliotrope/gmail-dumper.rb:171:in 
`next_message': undefined method `empty?' for nil:NilClass (NoMethodError)
        from bin/heliotrope-add:128:in `&lt;main&gt;'
#####################################################


Finally the leveldb branch is not working that well. After reaching 130378 
indexed messages I started the heliotrope server and the web interface only 
showed two messages. 

I will try again without the hooks for Japanese and see how it goes.


On Wednesday 22 June 2011 12:25:16 William Morgan wrote:
&gt; Hi Horacio,
&gt; 
&gt; Reformatted excerpts from William Morgan's message of 2011-06-20:
&gt; &gt; Ok, I have a potential fix for this that I'll try and get out tonight.
&gt; 
&gt; Can you please:
&gt; 
&gt; 1. git clone git://github.com/wmorgan/leveldb-ruby.git
&gt; 2. git checkout fpic
&gt; 3. rake gem
&gt; 4. gem install pkg/leveldb-ruby-0.4.gem
&gt; 
&gt; And tell me if that works?
&gt; 
&gt; If so, I will release that as 0.5.
&gt; 
&gt; Thanks!

-- 
regards,                                                                                                                                                                                                       
Horacio Sanson
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00113" href="msg00113.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00365" href="msg00365.html">[sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00070" href="msg00070.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00315" href="msg00315.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00224.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00113.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00338.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00113.html">Re: [sup-devel] Tokyo Cabinet fails with invalid record header</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00134"><strong>Date</strong></a></li>
<li><a href="threads.html#00134"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

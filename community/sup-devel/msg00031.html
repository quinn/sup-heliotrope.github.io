<!-- MHonArc v2.6.18 -->
<!--X-Subject: [sup&#45;devel] check keys before sending -->
<!--X-From-R13: Febl Enaxrl <fnaxrlgzfNtznvy.pbz> -->
<!--X-Date: Sat, 10 May 2014 01:55:59 &#45;0700 (PDT) -->
<!--X-Message-Id: 1399708417&#45;sup&#45;4178@ultralap.site -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Derived: pgpEcWLpjwFV0.pgp -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[sup-devel] check keys before sending</title>
<link rev="made" href="mailto:sankeytms@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00007.html">Date Prev</a>][<a href="msg00024.html">Date Next</a>][<a href="msg00007.html">Thread Prev</a>][<a href="msg00024.html">Thread Next</a>][<a href="maillist.html#00031">Date Index</a>][<a href="threads.html#00031">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sup-devel] check keys before sending</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sup-devel &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: [sup-devel] check keys before sending</li>
<li><em>From</em>: Troy Sankey &lt;<a href="mailto:sankeytms%40gmail.com">sankeytms@gmail.com</a>&gt;</li>
<li><em>Date</em>: Sat, 10 May 2014 01:23:11 -0700</li>
<li><em>Authentication-results</em>: mx.google.com;       spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 50.56.192.79 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>;       dkim=neutral (body hash did not verify) header.i=@;       dmarc=fail (p=NONE dis=NONE) header.from=gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=from:to:subject:date:message-id:user-agent	:content-transfer-encoding:mime-version:content-type;	bh=lYV4memYmLHL0lsbxkJqQ1FwLQPONgbgDsGMl63SaAA=;	b=gbA8eeyGTNz1ftJ47UsSmGR2vBppP8oo9jBgQw4DacybiPNvd7d+3QseOwJX6NeWEw	AwHgLR8iFMNUIwMDQjXFyQmfT9gM2FcbKmRv1zAFNxHOSMerdiDU5FyxgjKVmSlt7G0p	in9ZaBwfq4ZQCibqX4n2Tf36oCzd8050c5/G40dtDL0ilzyMUl8QiJDFW6W472bHfLJT	Lsn3yDApFW6cLTp/RS/tWBtErXtp+41X3W8x7PqTMvMF6kVQh2MUSAXM46cxiFCyIU8M	xpRpt8nNS1PYqc+4j8E8JzTcXQ2QWfF1xNtqJsLWOurq/k7Pwhmr+ckp6rIU5+BVp+GY	kQrA==</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: Sup/0.17.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi sup developers,

Recently I sent an encrypted message to a group of recipients, thinking
that all their keys were still valid.  However, one of them had an
expired key, so the message was not encrypted to that recipient and he
could not read it.

I want sup to prompt the user about potentially invalid keys before
sending a message.  I think the code will look something like this:


diff --git a/lib/sup/crypto.rb b/lib/sup/crypto.rb
index fd8f824..88ae3cc 100644
--- a/lib/sup/crypto.rb
+++ b/lib/sup/crypto.rb
@@ -167,6 +167,14 @@ EOS
                                {:operation =&gt; &quot;encrypt&quot;, :options =&gt; gpg_opts}) || gpg_opts
     recipients = to + [from]
     recipients = HookManager.run(&quot;gpg-expand-keys&quot;, { :recipients =&gt; recipients }) || recipients
+
+    # make sure all recipients can be encrypted-to
+    recipients.each do |recipient|
+      if GPGME::Key.find(:public, recipient).length == 0 and !BufferManager.ask_yes_or_no(&quot;Could not encrypt to #{recipient}. Really send?&quot;)
+        raise Error, &quot;Send message cancelled.&quot;
+      end
+    end
+
     begin
       if GPGME.respond_to?('encrypt')
         cipher = GPGME.encrypt(recipients, format_payload(payload), gpg_opts)


I have not tested this patch, so if it looks wrong then it probably is!
Does anybody have any thoughts on this feature?

Troy
</pre><p><strong>Attachment:
<a href="pgpEcWLpjwFV0.pgp" ><tt>signature.asc</tt></a></strong><br>
<em>Description:</em> PGP signature</p>
<pre>_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00024" href="msg00024.html">Re: [sup-devel] check keys before sending</a></strong>
<ul><li><em>From:</em> Gaute Hope &lt;eg@gaute.vetsj.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00007.html">more colors for you</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00024.html">Re: [sup-devel] check keys before sending</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00007.html">more colors for you</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00024.html">Re: [sup-devel] check keys before sending</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00031"><strong>Date</strong></a></li>
<li><a href="threads.html#00031"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

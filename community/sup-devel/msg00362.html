<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;devel] Cannot query Japanese characters -->
<!--X-From-R13: Vbenpvb Enafba <ufnafbaNtznvy.pbz> -->
<!--X-Date: Thu, 9 Jun 2011 07:09:08 &#45;0700 (PDT) -->
<!--X-Message-Id: BANLkTin8e2C9YGFCR1ob5VZJdjWxY4=mGA@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 201104251023.19659.hsanson@gmail.com -->
<!--X-Reference: 1303793294&#45;sup&#45;688@masanjin.net -->
<!--X-Reference: 1304052708&#45;sup&#45;4240@masanjin.net -->
<!--X-Reference: BANLkTim9PigP91LaDQ6UG2_prxncYv1zEA@mail.gmail.com -->
<!--X-Reference: BANLkTi=ObuZiHWGs7Mtvh8J5k4J3KTxgMA@mail.gmail.com -->
<!--X-Reference: BANLkTi=tSnbEijoEHG76Z5Fy9&#45;3G4TPxVw@mail.gmail.com -->
<!--X-Reference: 1304460745&#45;sup&#45;6241@masanjin.net -->
<!--X-Reference: BANLkTikbENFqT2GsE5uWjqN_DTMq43FFkw@mail.gmail.com -->
<!--X-Reference: 1304527268&#45;sup&#45;7661@masanjin.net -->
<!--X-Reference: BANLkTimr0u=6oB4uSK_6itUU2UMR&#45;yJz+w@mail.gmail.com -->
<!--X-Reference: 1307509658&#45;sup&#45;6995@masanjin.net -->
<!--X-Reference: BANLkTim6_vC3K+ZcrTPgLnckYPRLxG9zOQ@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-devel] Cannot query Japanese characters</title>
<link rev="made" href="mailto:hsanson@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00249.html">Date Prev</a>][<a href="msg00371.html">Date Next</a>][<a href="msg00371.html">Thread Prev</a>][<a href="msg00092.html">Thread Next</a>][<a href="maillist.html#00362">Date Index</a>][<a href="threads.html#00362">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-devel] Cannot query Japanese characters</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-devel] Cannot query Japanese characters</li>
<li><em>From</em>: Horacio Sanson &lt;<a href="mailto:hsanson%40gmail.com">hsanson@gmail.com</a>&gt;</li>
<li><em>Date</em>: Thu, 9 Jun 2011 23:08:56 +0900</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:mime-version:in-reply-to:references:date	:message-id:subject:from:to:content-type:content-transfer-encoding;	bh=ymhsbzZJKUPWANwI+IVw40gXFnpc6a5F6tn9YfRQ3ZI=;	b=DcBl1+Po+iI0Qolx7G9Aoqq984MC29OQ8nPwFRp27ZAFvuTlLFGgchReLy4VUK5cfn	uWW37lDaB1CEEIDbMqMGrY1t6fi62oHEVjddL+DMQiRNRDPaMMyoy/sm0w/Wm+zVUTjV	jEbtF4/g4l+hWxyvKvwjw3TVqiCHmPqYGJ6Iw=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=mime-version:in-reply-to:references:date:message-id:subject:from:to	:content-type:content-transfer-encoding;	b=VOBq20C1fBVG1K3gU8J18mRoz6OhgoG/4seJmX8kFWugEEUdbWWmw7YCiDOox1KubU	Tx39nLLN4jHaN2Hk5eomZ16Nt/GiUmxeOgnuMSbCjtLACZSr0b5Q9rK/O4BDYhBx4VQ0	w5OVx6oXBWnxqvaSTUuGnyQ2wFybm8MGN41iY=</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00371.html">BANLkTim6_vC3K+ZcrTPgLnckYPRLxG9zOQ@mail.gmail.com</a>&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg00765.html">201104251023.19659.hsanson@gmail.com</a>&gt;	&lt;<a href="msg00613.html">1303793294-sup-688@masanjin.net</a>&gt;	&lt;<a href="msg00546.html">1304052708-sup-4240@masanjin.net</a>&gt;	&lt;<a href="msg00515.html">BANLkTim9PigP91LaDQ6UG2_prxncYv1zEA@mail.gmail.com</a>&gt;	&lt;BANLkTi=ObuZiHWGs7Mtvh8J5k4J3KTxgMA@mail.gmail.com&gt;	&lt;BANLkTi=tSnbEijoEHG76Z5Fy9-3G4TPxVw@mail.gmail.com&gt;	&lt;<a href="msg00611.html">1304460745-sup-6241@masanjin.net</a>&gt;	&lt;<a href="msg00623.html">BANLkTikbENFqT2GsE5uWjqN_DTMq43FFkw@mail.gmail.com</a>&gt;	&lt;<a href="msg00772.html">1304527268-sup-7661@masanjin.net</a>&gt;	&lt;BANLkTimr0u=6oB4uSK_6itUU2UMR-yJz+w@mail.gmail.com&gt;	&lt;<a href="msg00159.html">1307509658-sup-6995@masanjin.net</a>&gt;	&lt;<a href="msg00371.html">BANLkTim6_vC3K+ZcrTPgLnckYPRLxG9zOQ@mail.gmail.com</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Unfortunately the gmail sync failed....  Below the error:

 requesting messages 40266..40315 from imap server
; gmail loving gave us 19 messages in 4.6s = a whopping 4.1m/s
scanned 748, indexed 747, skipped 0 bad and 1 seen messages in 400.4s = 1.9 m/s
; requesting messages 40316..40365 from imap server
; gmail loving gave us 8 messages in 2.2s = a whopping 3.7m/s
; requesting messages 40366..40415 from imap server
/media/DATA/Apps/heliotrope/lib/heliotrope/imap-dumper.rb:73:in
`next_message': undefined method `size' for nil:NilClass
(NoMethodError)
        from bin/heliotrope-add:128:in `&lt;main&gt;'

For some reason &quot;uid_fetch&quot; is returning nil instead of an empty array
(contrary to what Net::IMAP documentation says). Not really sure if
checking for nil and simply repeat the query can resolve the problem
but seems to be the best option.


regards
Horacio



On Thu, Jun 9, 2011 at 10:48 PM, Horacio Sanson &lt;hsanson@gmail.com&gt; wrote:
&gt; On Wed, Jun 8, 2011 at 2:21 PM, William Morgan &lt;wmorgan-sup@masanjin.net&gt; wrote:
&gt;&gt; Reformatted excerpts from Horacio Sanson's message of 2011-05-06:
&gt;&gt;&gt; Great, let me know when you have the modifications so I can stress
&gt;&gt;&gt; test them.
&gt;&gt;
&gt;&gt; In the most recent version of Heliotrope, there are two hooks you can
&gt;&gt; use to do this: transform-text and transform-query. To use them, place
&gt;&gt; your Ruby code in files called &lt;store dir&gt;/hooks/&lt;hook-name&gt;.rb.
&gt;&gt;
&gt;&gt; For transform-text, place your code in &lt;store dir&gt;/hooks/transform-text.rb
&gt;&gt; This hook will be called on any text added to the index. The 'text'
&gt;&gt; variable will contain the text, and the hook should return (i.e. the
&gt;&gt; last command should evaluate to) the transformed text.
&gt;&gt;
&gt;&gt; Example:
&gt;&gt; &#xA0;$ cat store/hooks/transform-text.rb
&gt;&gt; &#xA0;require 'MeCab'
&gt;&gt; &#xA0;MeCab::Tagger.new(&quot;-Owakati&quot;).parse(text).gsub(/\s+/, &quot; &quot;)
&gt;&gt;
&gt;&gt; For transform-query, place your code in &lt;store
&gt;&gt; &#xA0;dir&gt;/hooks/transform-query.rb. This hook will be called on any query
&gt;&gt; before it is executed. The 'query' variable will contain the query
&gt;&gt; string, and the hook should return (i.e. the last command should
&gt;&gt; evaluate to) the transformed query.
&gt;&gt;
&gt;&gt; Example:
&gt;&gt; &#xA0;$ cat store/hooks/transform-query.rb
&gt;&gt; &#xA0;require 'MeCab'
&gt;&gt; &#xA0;MeCab::Tagger.new(&quot;-Owakati&quot;).parse(query).gsub(/\s+/, &quot; &quot;)
&gt;&gt;
&gt;&gt; Let me know if you have any problems with these hooks!
&gt;
&gt; Great I am downloading my gmail accounts now (again). I can see you
&gt; have improved the imap-dumper.rb to handle uidvalidity and uidnext
&gt; that is also great. In the git log says gmail labels are also copied
&gt; to heliotrope but I don't see them in my index.
&gt;
&gt; BTW there are two small bugs in the imap-dumper.rb, see attached patch
&gt; for details.
&gt;
&gt; regards,
&gt; Horacio
&gt;
&gt;&gt; --
&gt;&gt; William &lt;wmorgan-sup@masanjin.net&gt;
&gt;&gt; _______________________________________________
&gt;&gt; Sup-devel mailing list
&gt;&gt; Sup-devel@rubyforge.org
&gt;&gt; <a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
&gt;&gt;
&gt;
&gt; gmail
&gt;
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00765" href="msg00765.html">[sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00613" href="msg00613.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00546" href="msg00546.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00515" href="msg00515.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00746" href="msg00746.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00747" href="msg00747.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00611" href="msg00611.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00623" href="msg00623.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00772" href="msg00772.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00624" href="msg00624.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
<li><strong><a name="00159" href="msg00159.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00371" href="msg00371.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
<ul><li><em>From:</em> Horacio Sanson &lt;hsanson@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00249.html">Re: Another UTF-8 exception: edit-message-mode.rb</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00371.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00371.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00092.html">Re: [sup-devel] Cannot query Japanese characters</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00362"><strong>Date</strong></a></li>
<li><a href="threads.html#00362"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

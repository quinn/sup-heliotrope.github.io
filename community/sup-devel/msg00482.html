<!-- MHonArc v2.6.18 -->
<!--X-Subject: [sup&#45;devel] Fixed bug with messages not being signed. -->
<!--X-From-R13: Vnzvfu <qzvfuqNtznvy.pbz> -->
<!--X-Date: Sun, 30 Jan 2011 15:22:30 &#45;0800 (PST) -->
<!--X-Message-Id: 1296426286&#45;sup&#45;8656@whisper -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[sup-devel] Fixed bug with messages not being signed.</title>
<link rev="made" href="mailto:dmishd@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00558.html">Date Prev</a>][<a href="msg00683.html">Date Next</a>][<a href="msg00621.html">Thread Prev</a>][<a href="msg00683.html">Thread Next</a>][<a href="maillist.html#00482">Date Index</a>][<a href="threads.html#00482">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sup-devel] Fixed bug with messages not being signed.</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sup-devel &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: [sup-devel] Fixed bug with messages not being signed.</li>
<li><em>From</em>: Hamish &lt;<a href="mailto:dmishd%40gmail.com">dmishd@gmail.com</a>&gt;</li>
<li><em>Date</em>: Sun, 30 Jan 2011 22:57:02 +0000</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:content-type:subject:from:to:date:message-id	:user-agent:content-transfer-encoding;	bh=RP6qaAl9JPxJt4IXLSKZ+4k2QMOjAB0ijzT58ZDGQG0=;	b=gnYVQ1C5ZOxown2hSqU4oiYiObZ8GqNxNYG3Uo79JMND5DlEsDYjurxD4adVaszu6P	dN8xnszLDIuamo3etxBVkmZm2ba7VM0bQYpIkvN+1iASktiORdIosZyOlmuwhM+jBUUb	S5Ra1WmiYKgWe6c1aNam/ngS3lcsNqmrIQP6k=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=content-type:subject:from:to:date:message-id:user-agent	:content-transfer-encoding;	b=BAoejHbxhQrLyXF6zLryBscQy2kzeIjtFX95QG1ETZ15UsmHvGuT1LAC1Kqv1axZ2x	MW7UETvSdvdpiI1EGH4AFsApyxnHPuxX7B0ejzrXSlxRaWAbqeA5GIRnLoLbToNlET2i	0c++PsEclHw0VGVE4Kz0PWN0l0zG0PzHA9JAc=</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: Sup/git</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Found the bug that stopped people signing email. Needed to use merge! 
rather than merge. Real slap on head moment.

I've committed it to the (existing) gpgme branch and to next.

Hamish Downer



Full patch is:

commit 42149329b37af5e3fc0183367521999c479b7881
Author: Hamish Downer &lt;dmishd@gmail.com&gt;
Date:   Sun Jan 30 22:44:05 2011 +0000

    Fixed the bug that stopped emails being signed.
    
    Schoolboy error - needed merge! rather than merge

diff --git a/lib/sup/crypto.rb b/lib/sup/crypto.rb
index e532261..5f1b730 100644
--- a/lib/sup/crypto.rb
+++ b/lib/sup/crypto.rb
@@ -57,7 +57,7 @@ EOS
     return unknown_status(cant_find_gpgme) unless @gpgme_present
 
     gpg_opts = {:protocol =&gt; GPGME::PROTOCOL_OpenPGP, :armor =&gt; true, :textmode =&gt; true}
-    gpg_opts.merge(gen_sign_user_opts(from))
+    gpg_opts.merge!(gen_sign_user_opts(from))
     gpg_opts = HookManager.run(&quot;gpg-options&quot;, 
                                {:operation =&gt; &quot;sign&quot;, :options =&gt; gpg_opts}) || gpg_opts
 
@@ -82,8 +82,8 @@ EOS
 
     gpg_opts = {:protocol =&gt; GPGME::PROTOCOL_OpenPGP, :armor =&gt; true, :textmode =&gt; true}
     if sign
-      gpg_opts.merge(gen_sign_user_opts(from)) 
-      gpg_opts.merge({:sign =&gt; true})
+      gpg_opts.merge!(gen_sign_user_opts(from)) 
+      gpg_opts.merge!({:sign =&gt; true})
     end
     gpg_opts = HookManager.run(&quot;gpg-options&quot;, 
                                {:operation =&gt; &quot;encrypt&quot;, :options =&gt; gpg_opts}) || gpg_opts
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00558.html">Re: [sup-devel] Bug: UTF-8 error when sending messages</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00683.html">[sup-devel] more gpgme fixes</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00621.html">[sup-devel] UTF-8 error when sending messages</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00683.html">[sup-devel] more gpgme fixes</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00482"><strong>Date</strong></a></li>
<li><a href="threads.html#00482"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

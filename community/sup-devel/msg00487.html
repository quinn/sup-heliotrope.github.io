<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;devel] editing messages outside of sup -->
<!--X-From-R13: Vnzvfu <qzvfuqNtznvy.pbz> -->
<!--X-Date: Mon, 4 Apr 2011 16:31:47 &#45;0700 (PDT) -->
<!--X-Message-Id: 1301957971&#45;sup&#45;1165@whisper -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1298239068&#45;sup&#45;6985@whisper -->
<!--X-Reference: 1298747943&#45;sup&#45;9749@whisper -->
<!--X-Reference: 1298768518&#45;sup&#45;4041@alvh.no&#45;ip.org -->
<!--X-Reference: 1298774629&#45;sup&#45;4062@medusa -->
<!--X-Reference: 1298819507&#45;sup&#45;8138@pruts.nl -->
<!--X-Reference: 1298826314&#45;sup&#45;276@whisper -->
<!--X-Reference: 1298833983&#45;sup&#45;4830@pruts.nl -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-devel] editing messages outside of sup</title>
<link rev="made" href="mailto:dmishd@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00665.html">Date Prev</a>][<a href="msg00466.html">Date Next</a>][<a href="msg00495.html">Thread Prev</a>][<a href="msg00466.html">Thread Next</a>][<a href="maillist.html#00487">Date Index</a>][<a href="threads.html#00487">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-devel] editing messages outside of sup</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sup-devel &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-devel] editing messages outside of sup</li>
<li><em>From</em>: Hamish &lt;<a href="mailto:dmishd%40gmail.com">dmishd@gmail.com</a>&gt;</li>
<li><em>Date</em>: Tue, 05 Apr 2011 00:01:18 +0100</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:content-type:subject:from:to:in-reply-to	:references:date:message-id:user-agent:content-transfer-encoding;	bh=kA4w6bxbI/DyqtqCkx8leZO535sfGb0woLC7UHX7Cco=;	b=qsiNZKZvwpajqU+YqUlkSQhSAd9jXJQE9+pPob9HIqg/OnFEtRESGnRed/MouzBsKu	YClmrNc2xAXDJ/RS4b9IYFp1CW9F2fe8FXfmaPyGwezh80pXYny0bK1OuBMECpinZHHx	T5RBDvB9j5ky9+Rppf70kJ3SdsvA9XOmaUpjc=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=content-type:subject:from:to:in-reply-to:references:date:message-id	:user-agent:content-transfer-encoding;	b=rY196lf86ut6PoJJ+B/BUuqo/nk66PEk4kamZVJ1tHIRMXgOOWzLsXSxXUnwzsgTqz	jJUN0XIC2ypFl8pYsxx43YPXhxb2Cpe0Hx43pbs3SQiFipshxV+laFOldAKRRF0Z5c18	9FL2wE628uILKzadvsjwb1jf2cg+zxaKrz+3w=</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00495.html">1298833983-sup-4830@pruts.nl</a>&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-devel">http://rubyforge.org/pipermail/sup-devel</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=help">mailto:sup-devel-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: Sup developer discussion &lt;sup-devel.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-devel@rubyforge.org">mailto:sup-devel@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=subscribe">mailto:sup-devel-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-devel">http://rubyforge.org/mailman/options/sup-devel</a>&gt;,	&lt;<a href="mailto:sup-devel-request@rubyforge.org?subject=unsubscribe">mailto:sup-devel-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;1298239068-sup-6985@whisper&gt; &lt;1298747943-sup-9749@whisper&gt;	&lt;<a href="msg00538.html">1298768518-sup-4041@alvh.no-ip.org</a>&gt;	&lt;1298774629-sup-4062@medusa&gt; &lt;<a href="msg00585.html">1298819507-sup-8138@pruts.nl</a>&gt;	&lt;1298826314-sup-276@whisper&gt; &lt;<a href="msg00495.html">1298833983-sup-4830@pruts.nl</a>&gt;</li>
<li><em>Reply-to</em>: Sup developer discussion &lt;<a href="mailto:sup-devel%40rubyforge.org">sup-devel@rubyforge.org</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-devel-bounces%40rubyforge.org">sup-devel-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: Sup/git</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Excerpts from Ico Doornekamp's message of Sun Feb 27 19:44:15 +0000 2011:
&gt; &gt; Excerpts from Ico Doornekamp's message of Sun Feb 27 15:31:14 +0000 2011:
&gt; &gt; &gt; &gt; Hamish, definitely thank you for doing something about this.  I
&gt; &gt; &gt; &gt; actually had a general question about this problem a while back - if
&gt; &gt; &gt; &gt; it is possible to edit the message independently via the approach you
&gt; &gt; &gt; &gt; took in this patch, why can't the editor be fired up in a
&gt; &gt; &gt; &gt; &quot;nonblocking&quot; kind of mode in the first place?  Something like a
&gt; &gt; &gt; &gt; fork()/exec() to start the editor, and then handling SIGCHLD rather
&gt; &gt; &gt; &gt; than calling a variant of wait() immediately.  The SIGCHLD handling
&gt; &gt; &gt; &gt; could check the return code from the editor, and then update the
&gt; &gt; &gt; &gt; message sending buffer appropriately.
&gt; 
&gt; When the infrastructure for background-editor hooks is there, I'm ready
&gt; to try to make the hook!

OK, I've pushed a change to allow hooks for this functionality. For now
it is just on the async_message_edit branch (in the main gitorious
repo).

To quote from the hook text:

  Runs when 'H' is pressed in async edit mode. You can run whatever code
  you want here - though the default case would be launching a text
  editor. Your hook is assumed to not block, so you should use exec() or
  fork() to launch the editor.

  Once the hook has returned then sup will be responsive as usual. You will
  still need to press 'E' to exit this buffer and send the message.

  Variables:
  file_path: The full path to the file containing the message to be edited.

  Return value: None


If the hook did block then sup would be unresponsive, which would kind
of ruin the point of the exercise.

So this should work fine to launch a GUI text editor - your hook could
just be:

  fork { system &quot;/usr/bin/gedit #{file_path} &gt; /dev/null 2&gt;&amp;1&quot; }

(Note that if you don't redirect all output to /dev/null then you can end
up with the screen being written all over, which gets a bit messy ...)

The next step would be to have the async mode exit as soon as the forked
hook code has finished. The best way I've thought of to do this is to
trap SIGUSR1. As long as there was only one async mode active this would
work fine, but if there were two there would be trouble. I guess I could
add a return value to the hook about whether to pay attention to
SIGUSR1. Then the BufferManager could know which buffer was waiting for
SIGUSR1. If a second buffer called the same hook while the first was
still waiting for the signal, then it should refuse to honour it. It
does feel a bit messy ... I might have a go at it at some point, but if
anyone has other ideas, then please shout out.

Hamish
_______________________________________________
Sup-devel mailing list
Sup-devel@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-devel">http://rubyforge.org/mailman/listinfo/sup-devel</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00466" href="msg00466.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Ico Doornekamp &lt;sup@zevv.nl&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00577" href="msg00577.html">[sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Hamish &lt;dmishd@gmail.com&gt;</li></ul></li>
<li><strong><a name="00549" href="msg00549.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Hamish &lt;dmishd@gmail.com&gt;</li></ul></li>
<li><strong><a name="00538" href="msg00538.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Alvaro Herrera &lt;alvherre@alvh.no-ip.org&gt;</li></ul></li>
<li><strong><a name="00433" href="msg00433.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Roni Choudhury &lt;roni@cs.utah.edu&gt;</li></ul></li>
<li><strong><a name="00585" href="msg00585.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Ico Doornekamp &lt;sup@zevv.nl&gt;</li></ul></li>
<li><strong><a name="00540" href="msg00540.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Hamish &lt;dmishd@gmail.com&gt;</li></ul></li>
<li><strong><a name="00495" href="msg00495.html">Re: [sup-devel] editing messages outside of sup</a></strong>
<ul><li><em>From:</em> Ico Doornekamp &lt;sup@zevv.nl&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00665.html">Re: [sup-devel] turnsole alpha preview</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00466.html">Re: [sup-devel] editing messages outside of sup</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00495.html">Re: [sup-devel] editing messages outside of sup</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00466.html">Re: [sup-devel] editing messages outside of sup</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00487"><strong>Date</strong></a></li>
<li><a href="threads.html#00487"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

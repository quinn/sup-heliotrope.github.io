<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: [sup&#45;talk] [sup&#45;devel] [heliotrope] crashes while importing -->
<!--X-From-R13: =?GFT&#45;8?C?Xbunaa_Yy=Q3=O4ua?= <xywbunaaNtznvy.pbz> -->
<!--X-Date: Sun, 24 Jun 2012 05:05:13 &#45;0700 (PDT) -->
<!--X-Message-Id: CAE+8KM1J_Q&#45;N+2Sopq7Ta0nebk85MfK9DzxnerKHgpLz68&#45;Rzg@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20120301151701.23555.84803@localhost -->
<!--X-Reference: 1330985181&#45;sup&#45;8598@typhon -->
<!--X-Reference: CAE+8KM0gu1UD=gGXfiEwmceW82AxF02Y+=Y&#45;AZTW3SR5hToXZg@mail.gmail.com -->
<!--X-Reference: CAE+8KM3BeubqLWAZFYOYjEiVUYpQT3vhwhaf37r1BzVECngbJA@mail.gmail.com -->
<!--X-Reference: 1334932275&#45;turnsole&#45;49140@terminus&#45;est -->
<!--X-Reference: CAE+8KM0SqqLfGKnTTAw6TDRdb0eTBftJdueBghGxnoXE+wN3hg@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [sup-talk] [sup-devel] [heliotrope] crashes while importing</title>
<link rev="made" href="mailto:kljohann@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00148.html">Date Prev</a>][<a href="msg00080.html">Date Next</a>][<a href="msg00164.html">Thread Prev</a>][<a href="msg00328.html">Thread Next</a>][<a href="maillist.html#00292">Date Index</a>][<a href="threads.html#00292">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [sup-talk] [sup-devel] [heliotrope] crashes while importing</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: William Morgan &lt;<a href="mailto:wmorgan%40masanjin.net">wmorgan@masanjin.net</a>&gt;</li>
<li><em>Subject</em>: Re: [sup-talk] [sup-devel] [heliotrope] crashes while importing</li>
<li><em>From</em>: Johann Kl&#xE4;hn &lt;<a href="mailto:kljohann%40gmail.com">kljohann@gmail.com</a>&gt;</li>
<li><em>Date</em>: Sun, 24 Jun 2012 14:00:39 +0200</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-talk-bounces%40rubyforge.org">sup-talk-bounces@rubyforge.org</a> designates 50.56.192.79 as permitted sender) smtp.mail=<a href="mailto:sup-talk-bounces%40rubyforge.org">sup-talk-bounces@rubyforge.org</a>; dkim=neutral (body hash did not verify) header.i=@gmail.com</li>
<li><em>Cc</em>: sup-talk &lt;<a href="mailto:sup-talk%40rubyforge.org">sup-talk@rubyforge.org</a>&gt;</li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-talk%40rubyforge.org">sup-talk@rubyforge.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;	h=mime-version:in-reply-to:references:from:date:message-id:subject:to	:cc:content-type;	bh=XLvzi95v52Mbk9TaIxpNtaNL3kZQ1VUEpStPpRSWefE=;	b=blUgdY5o1uplul/AaC7RlzzT0l+PB0FPdYQWn+/lLCDjhjaJ127RxEHKtxGSRqIlRe	G04X7HpBCjC9ZinsdijeChUkUC60G8ZPDG5ZZ77i6vkkQV7fThFfsMj1B/g3ru3P7OKC	Tnjq+eHKLlmH4wXqs/KaHHVdrL2xWgrjn2TJkM1p9VWGrAW2V67dDOTVb7OD+0r7g1zE	tZC5NryFeLLuZcgMxAKUayrv2GnbqpfsgVXIiOtcdduUEVCexrlytTHyv+z2FJEq+W8/	wkZCLpBvpjuD33Z4sfye5sluAz5i1rAKq4HyTPEfDlnadBMYQbT2RwLreWKb7MWe50Ve	UDog==</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00164.html">CAE+8KM0SqqLfGKnTTAw6TDRdb0eTBftJdueBghGxnoXE+wN3hg@mail.gmail.com</a>&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-talk">http://rubyforge.org/pipermail/sup-talk</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-talk-request@rubyforge.org?subject=help">mailto:sup-talk-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: User &amp; developer discussion of Sup &lt;sup-talk.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-talk@rubyforge.org">mailto:sup-talk@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-talk">http://rubyforge.org/mailman/listinfo/sup-talk</a>&gt;,	&lt;<a href="mailto:sup-talk-request@rubyforge.org?subject=subscribe">mailto:sup-talk-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-talk">http://rubyforge.org/mailman/options/sup-talk</a>&gt;,	&lt;<a href="mailto:sup-talk-request@rubyforge.org?subject=unsubscribe">mailto:sup-talk-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;20120301151701.23555.84803@localhost&gt; &lt;1330985181-sup-8598@typhon&gt;	&lt;CAE+8KM0gu1UD=gGXfiEwmceW82AxF02Y+=Y-AZTW3SR5hToXZg@mail.gmail.com&gt;	&lt;CAE+8KM3BeubqLWAZFYOYjEiVUYpQT3vhwhaf37r1BzVECngbJA@mail.gmail.com&gt;	&lt;1334932275-turnsole-49140@terminus-est&gt;	&lt;<a href="msg00164.html">CAE+8KM0SqqLfGKnTTAw6TDRdb0eTBftJdueBghGxnoXE+wN3hg@mail.gmail.com</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-talk-bounces%40rubyforge.org">sup-talk-bounces@rubyforge.org</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>I just tried this again and the source of this problem does not seem
to be memcpy vs memmove but that Append tries to copy data to
unallocated memory.
Note below that limit_ points to a string &quot;wp/labels&quot;. This may
indicate a stack overflow, I guess (Though I'm not too proficient in
debugging C++).

My test machine is running x86_64 (intel), ruby 1.9.3p194 and
leveldb-ruby built from git HEAD.

Program received signal SIGBUS, Bus error.
0x00007ffff7753ceb in __memcpy_ssse3_back () from /lib/libc.so.6
(gdb) bt
#0  0x00007ffff7753ceb in __memcpy_ssse3_back () from /lib/libc.so.6
#1  0x00007ffff3777181 in leveldb::(anonymous
namespace)::PosixMmapFile::Append (this=0x107d760, data=...) at
util/env_posix.cc:227
#2  0x00007ffff3757cbc in leveldb::log::Writer::EmitPhysicalRecord
(this=0x1009af0, t=leveldb::log::kFullType,
    ptr=0x10065d8 &quot;\264\n&quot;, n=150) at db/log_writer.cc:93
#3  0x00007ffff3757a9a in leveldb::log::Writer::AddRecord
(this=0x1009af0, slice=...) at db/log_writer.cc:67
#4  0x00007ffff374980e in leveldb::DBImpl::Write (this=0x107aa40,
options=..., my_batch=0x7fffffffdb00) at db/db_impl.cc:1140
#5  0x00007ffff374a90a in leveldb::DB::Put (this=0x107aa40, opt=...,
key=..., value=...) at db/db_impl.cc:1369
#6  0x00007ffff3749573 in leveldb::DBImpl::Put (this=0x107aa40, o=...,
key=..., val=...) at db/db_impl.cc:1103

(gdb) up
#1  0x00007ffff3777181 in leveldb::(anonymous
namespace)::PosixMmapFile::Append (this=0x107d760, data=...) at
util/env_posix.cc:227
227	      memcpy(dst_, src, n);

(gdb) print dst_
$34 = 0x7ffff7e69fb5 &quot;&quot;

(gdb) print n
$11 = 150

(gdb) print dst_ + (n-1)
$1 = 0x7ffff7e6a04a &lt;Address 0x7ffff7e6a04a out of bounds&gt;
(gdb) print dst_ + (n-2)
$2 = 0x7ffff7e6a049 &lt;Address 0x7ffff7e6a049 out of bounds&gt;

(gdb) print dst_ + 80
$16 = 0x7ffff7e6a005 &lt;Address 0x7ffff7e6a005 out of bounds&gt;
(gdb) print dst_ + 74
$22 = 0x7ffff7e69fff &quot;&quot;
(gdb) print dst_ + 75
$23 = 0x7ffff7e6a000 &lt;Address 0x7ffff7e6a000 out of bounds&gt;

(gdb) print limit_
$24 = 0x7ffff7e78000 &quot;wp/labels&quot;
(gdb) print limit_ + 1
$25 = 0x7ffff7e78001 &quot;p/labels&quot;
(gdb) print limit_ - 1
$26 = 0x7ffff7e77fff &lt;Address 0x7ffff7e77fff out of bounds&gt;

(gdb) print map_size_
$28 = 65536
(gdb) print page_size_
$29 = 4096
(gdb) print base_
$30 = 0x7ffff7e68000 &quot;\247T\210\024\036&quot;
(gdb) print last_sync_
$31 = 0x7ffff7e68000 &quot;\247T\210\024\036&quot;
(gdb) print file_offset_
$32 = 0
_______________________________________________
sup-talk mailing list
sup-talk@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-talk">http://rubyforge.org/mailman/listinfo/sup-talk</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00261" href="msg00261.html">[sup-talk] Fwd: [sup-devel] [heliotrope] crashes while importing</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan@masanjin.net&gt;</li></ul></li>
<li><strong><a name="00164" href="msg00164.html">Re: [sup-talk] [sup-devel] [heliotrope] crashes while importing</a></strong>
<ul><li><em>From:</em> Johann Kl&#xE4;hn &lt;kljohann@gmail.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00148.html">Re: [sup-talk] [PATCH] detect and set charset on text/* attachments</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00080.html">[sup-talk] Sup crash</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00164.html">Re: [sup-talk] [sup-devel] [heliotrope] crashes while importing</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00328.html">[sup-talk] Fwd: Hook to labelize sended emails?</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00292"><strong>Date</strong></a></li>
<li><a href="threads.html#00292"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>

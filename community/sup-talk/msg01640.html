<!-- MHonArc v2.6.18 -->
<!--X-Subject: [sup&#45;talk] Localized date on mbox From line in sent messages -->
<!--X-From-R13: Freb Fvyhf <grebNgvyhf.arg> -->
<!--X-Date: Thu, 22 Oct 2009 23:00:28 &#45;0700 (PDT) -->
<!--X-Message-Id: 1256276875&#45;sup&#45;5782@tilus.net -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[sup-talk] Localized date on mbox From line in sent messages</title>
<link rev="made" href="mailto:tero@tilus.net">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg01632.html">Date Prev</a>][<a href="msg01489.html">Date Next</a>][<a href="msg01671.html">Thread Prev</a>][<a href="msg01596.html">Thread Next</a>][<a href="maillist.html#01640">Date Index</a>][<a href="threads.html#01640">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[sup-talk] Localized date on mbox From line in sent messages</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sup-talk &lt;<a href="mailto:sup-talk%40rubyforge.org">sup-talk@rubyforge.org</a>&gt;</li>
<li><em>Subject</em>: [sup-talk] Localized date on mbox From line in sent messages</li>
<li><em>From</em>: Tero Tilus &lt;<a href="mailto:tero%40tilus.net">tero@tilus.net</a>&gt;</li>
<li><em>Date</em>: Fri, 23 Oct 2009 09:00:12 +0300</li>
<li><em>Authentication-results</em>: mx.google.com; spf=pass (google.com: domain of <a href="mailto:sup-talk-bounces%40rubyforge.org">sup-talk-bounces@rubyforge.org</a> designates 205.234.109.19 as permitted sender) smtp.mail=<a href="mailto:sup-talk-bounces%40rubyforge.org">sup-talk-bounces@rubyforge.org</a></li>
<li><em>Delivered-to</em>: <a href="mailto:eg%40gaute.vetsj.com">eg@gaute.vetsj.com</a></li>
<li><em>Delivered-to</em>: <a href="mailto:sup-talk%40rubyforge.org">sup-talk@rubyforge.org</a></li>
<li><em>List-archive</em>: &lt;<a href="http://rubyforge.org/pipermail/sup-talk">http://rubyforge.org/pipermail/sup-talk</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:sup-talk-request@rubyforge.org?subject=help">mailto:sup-talk-request@rubyforge.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: User &amp; developer discussion of Sup &lt;sup-talk.rubyforge.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:sup-talk@rubyforge.org">mailto:sup-talk@rubyforge.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://rubyforge.org/mailman/listinfo/sup-talk">http://rubyforge.org/mailman/listinfo/sup-talk</a>&gt;,	&lt;<a href="mailto:sup-talk-request@rubyforge.org?subject=subscribe">mailto:sup-talk-request@rubyforge.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://rubyforge.org/mailman/options/sup-talk">http://rubyforge.org/mailman/options/sup-talk</a>&gt;,	&lt;<a href="mailto:sup-talk-request@rubyforge.org?subject=unsubscribe">mailto:sup-talk-request@rubyforge.org?subject=unsubscribe</a>&gt;</li>
<li><em>Sender</em>: <a href="mailto:sup-talk-bounces%40rubyforge.org">sup-talk-bounces@rubyforge.org</a></li>
<li><em>User-agent</em>: Sup/git</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>This might be known.  I accidentally used 0.8.1 instead of git next
once and it screwed up my sent box.  After forwarding a mail sup
started to blow up (what felt like) after initiall poll.

NoMethodError from thread: poll after loading inbox
undefined method `[]' for nil:NilClass
/home/terotil/src/sup/lib/sup/xapian_index.rb:567:in `mkterm'
/home/terotil/src/sup/lib/sup/xapian_index.rb:338:in `find_docid'
/home/terotil/src/sup/lib/sup/xapian_index.rb:344:in `find_doc'
/home/terotil/src/sup/lib/sup/xapian_index.rb:354:in `get_entry'
/home/terotil/src/sup/lib/sup/xapian_index.rb:73:in `build_message'
/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'
/home/terotil/src/sup/lib/sup/xapian_index.rb:363:in `synchronize'
/home/terotil/src/sup/lib/sup/xapian_index.rb:73:in `build_message'
/home/terotil/src/sup/lib/sup/util.rb:520:in `send'
/home/terotil/src/sup/lib/sup/util.rb:520:in `method_missing'
/home/terotil/src/sup/lib/sup/poll.rb:109:in `do_poll'
/home/terotil/src/sup/lib/sup/poll.rb:166:in `each_message_from'
/home/terotil/src/sup/lib/sup/source.rb:104:in `each'

I went to throw in debugger and see what was inside.

/home/terotil/src/sup/lib/sup/poll.rb:109
old_m = Index.build_message m.id
(rdb:1) eval m
#&lt;Redwood::Message:0xb649d5e8 @attachments=[], @have_snippet=false, @source_info=4598, @chunks=[#&lt;Redwood::Chunk::Text:0xb648d328 @lines=[&quot;...&quot;, &quot;&quot;, &quot;***********************************************************************&quot;, &quot; An error occurred while loading this message. It is possible that&quot;, &quot; the source has changed, or (in the case of remote sources) is down.&quot;, &quot; You can check the log for errors, though hopefully an error window&quot;, &quot; should have popped up at some point.&quot;, &quot;&quot;, &quot; The message location was:&quot;, &quot; sup://sent#4598&quot;, &quot;***********************************************************************&quot;, &quot;&quot;, &quot;The error message was:&quot;, &quot;  mismatch in mbox file offset 4598: \&quot;From tero@tilus.net pe&quot;, &quot;loka\\302\\240\\302\\240 16 19:06:58 +0300 2009\\n\&quot;.&quot;]&gt;], @dirty=true, @snippet_contains_encrypted_content=false, @source=#&lt;Recoverable:0xb78023cc @error=#&lt;Redwood::OutOfSyncSourceError: mismatch in mbox file offset 4598: &quot;From tero@tilus.net pe loka\302\240\302\240 16 19:06:58 +0300 2
 009\n&quot;.&gt;, @mutex=#&lt;Mutex:0xb7802390&gt;, @o=#&lt;Redwood::SentLoader:0xb7809b2c @cur_offset=12856, @dirty=true, @uri=&quot;mbox:///home/terotil/.sup/sent.mbox&quot;, @archived=true, @path=&quot;/home/terotil/.sup/sent.mbox&quot;, @filename=&quot;/home/terotil/.sup/sent.mbox&quot;, @f=#&lt;File:/home/terotil/.sup/sent.mbox&gt;, @mutex=#&lt;Mutex:0xb7809adc&gt;, @labels=#&lt;Set: {}&gt;, @id=nil, @usual=true&gt;&gt;, @encrypted=false, @refs=[], @labels=#&lt;Set: {:sent, :inbox, :unread}&gt;, @snippet=nil&gt;

Okay, it could not load a message from sent box because it thought the
message wasnt there anymore.  The missmatch was because of the
starting From line had broken date.  It was a localized version of
what should have been there, with an added bonus of multibyte chars
(two nonbreaking spaces after month name, no idea how thats even
possible).

Fixed it by fixing the mbox.  Dunno how the broken header came to be.
The file has most certainly been accessed by sup alone.

Full broken headers follow

From tero@tilus.net pe loka&#xA0;&#xA0; 16 19:06:58 +0300 2009
Subject: Fwd: Neuroscience, Cogmed, and learning disabilities
From: Tero Tilus &lt;tero@tilus.net&gt;
To: joonas.kekkonen &lt;joonas.kekkonen@iki.fi&gt;
Date: Fri, 16 Oct 2009 19:06:58 +0300
Message-Id: &lt;1255709172-sup-7715@kuovi.tilus.net&gt;
User-Agent: Sup/0.8.1
Content-Transfer-Encoding: 8bit
Content-Type: multipart/mixed; boundary=&quot;=-1255709218-544380-431-3013-1-=&quot;
MIME-Version: 1.0

-- 
Tero Tilus ## 050 3635 235 ## <a  rel="nofollow" href="http://tero.tilus.net/">http://tero.tilus.net/</a>
_______________________________________________
sup-talk mailing list
sup-talk@rubyforge.org
<a  rel="nofollow" href="http://rubyforge.org/mailman/listinfo/sup-talk">http://rubyforge.org/mailman/listinfo/sup-talk</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="01596" href="msg01596.html">Re: [sup-talk] Localized date on mbox From line in sent messages</a></strong>
<ul><li><em>From:</em> William Morgan &lt;wmorgan-sup@masanjin.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01632.html">[sup-talk] (Orphaned?) bug tracker at rubyforge.org?</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01489.html">Re: [sup-talk] (Orphaned?) bug tracker at rubyforge.org?</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01671.html">Re: [sup-talk] (Orphaned?) bug tracker at rubyforge.org?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01596.html">Re: [sup-talk] Localized date on mbox From line in sent messages</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01640"><strong>Date</strong></a></li>
<li><a href="threads.html#01640"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
